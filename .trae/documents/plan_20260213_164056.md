# NanoBot 轻量级多Agent扩展方案

## 目标
在保持核心架构不变的情况下，为NanoBot添加多类型子Agent支持。

---

## Phase 1: Prompt模板系统 (1-2天)

### 1.1 新增文件: `nanobot/agent/prompts.py`

定义子Agent模板：

```python
SUBAGENT_TEMPLATES = {
    "minimal": {
        "description": "快速简单任务",
        "tools": ["read_file", "write_file", "list_dir", "exec", "web_search", "web_fetch"],
    },
    "coder": {
        "description": "代码编写任务",
        "tools": ["read_file", "write_file", "edit_file", "list_dir", "exec"],
        "rules": ["遵循项目代码规范", "写测试用例", "代码要简洁可读"],
    },
    "researcher": {
        "description": "信息检索研究",
        "tools": ["web_search", "web_fetch", "read_file"],
        "rules": ["准确引用来源", "提供可靠信息", "避免猜测"],
    },
    "analyst": {
        "description": "数据分析任务",
        "tools": ["read_file", "write_file", "exec"],
        "rules": ["分析要有数据支撑", "给出明确结论", "建议要可执行"],
    },
}
```

### 1.2 修改: `nanobot/agent/subagent.py`

- 添加 `_build_subagent_prompt(template: str, task: str)` 方法
- 支持不同模板生成不同系统Prompt

### 1.3 修改: `nanobot/agent/tools/spawn.py`

扩展parameters支持template参数：

```python
"parameters": {
    "properties": {
        "task": {...},
        "label": {...},
        "template": {
            "type": "string",
            "enum": ["minimal", "coder", "researcher", "analyst"],
            "description": "子Agent类型模板"
        },
    },
}
```

---

## Phase 2: 会话保持 (2-3天)

### 2.1 修改: `nanobot/agent/subagent.py`

- 添加会话ID生成和管理
- 支持通过session_id恢复已有会话
- 支持多轮对话（不立即通知结果）

### 2.2 扩展SpawnTool

新增参数：
- `session_id`: 继续已有会话
- `wait_result`: 是否等待结果（同步模式）

---

## Phase 3: 轻量级Memory隔离 (可选, 3-5天)

### 3.1 修改: `nanobot/agent/memory.py`

- 支持Agent子目录: `memory/agents/{agent_id}/`
- 添加Agent专属记忆读写方法

### 3.2 修改: `nanobot/agent/subagent.py`

- 子Agent可选择是否使用独立记忆

---

## 文件改动清单

| 文件 | 改动 | 工作量 |
|------|------|--------|
| 新增 `nanobot/agent/prompts.py` | Prompt模板定义 | 0.5天 |
| 修改 `nanobot/agent/subagent.py` | 模板支持+会话保持 | 2天 |
| 修改 `nanobot/agent/tools/spawn.py` | 参数扩展 | 0.5天 |
| 修改 `nanobot/agent/tools/base.py` | (如需要) | - |
| 修改 `nanobot/agent/memory.py` | (Phase 3) | 1天 |

---

## 预期效果

- 用户可选择不同类型子Agent
- coder模板：更适合写代码
- researcher模板：更适合调研
- analyst模板：更适合分析
- 未来可扩展更多模板

---

## 风险控制

- 先做Phase 1（最小改动）
- 每个Phase独立测试
- 保持向后兼容
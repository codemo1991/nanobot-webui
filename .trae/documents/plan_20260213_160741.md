## 高优先级Token优化方案

### 1. 单条消息长度限制
- 在 `Session.add_message()` 中添加 `max_content_length` 参数
- 默认限制8000字符，超出时截断并添加提示
- 修改文件：`nanobot/session/manager.py`

### 2. 配置化历史消息条数
- 在 `AgentDefaults` 中添加 `max_history_messages` 配置项
- 默认值30条（比当前50条更保守）
- 修改文件：`nanobot/config/schema.py`, `nanobot/agent/loop.py`

### 3. Tool Result截断长度可配置
- 在 `AgentDefaults` 中添加 `tool_result_max_length` 配置项
- 默认值2000字符（与当前行为一致）
- 修改文件：`nanobot/config/schema.py`, `nanobot/agent/loop.py`

### 4. 验证修改
- 运行现有测试确保功能正常